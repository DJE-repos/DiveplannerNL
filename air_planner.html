<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luchtplanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
			font-size: 12px;
			margin: 12px 0px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            font-size: 12px;
            padding: 8px 12px;
        }

        .btn-danger:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(238, 90, 82, 0.3);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 10px;
			font-size: 14px;
            text-align: left;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }

        th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
        }

        td {
            padding: 7px;
			font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.3s ease;
        }

        tr:hover td {
            background-color: #f8f9ff;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .editable {
            background: transparent;
            border: 2px solid transparent;
            padding: 8px;
            border-radius: 6px;
            width: 100%;
            font-size: 14px;
			
            transition: all 0.3s ease;
        }
		.readonly {
            background: transparent;
            border: 2px solid transparent;
            padding: 8px;
            border-radius: 6px;
            width: 100%;
            font-size: 14px;
			color: rgb(150,150,150);
            transition: all 0.3s ease;
        }
		.readonly:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .editable:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .actions {
            text-align: center;
            width: 200px;
        }

        .move-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-move {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            font-size: 12px;
            padding: 6px 10px;
            min-width: auto;
        }

        .btn-move:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-move:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .drag-handle {
            cursor: grab;
            font-size: 16px;
            padding: 5px;
            color: #667eea;
            user-select: none;
        }

        .drag-handle:hover {
            color: #764ba2;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zone {
            background: rgba(102, 126, 234, 0.1);
            border: 2px dashed #667eea;
        }

        .row-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            text-align: center;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .column-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .column-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 18px;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .chart-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #depthChart {
            width: 800px;
			max-width:80%
            height: 60%;
			max-height: 80%;
            display: block;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
		
		
		.settings-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .settings-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .settings-row {
            display: grid;
            align-items: center;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            
            flex-wrap: wrap;
        }
		
        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 12px;
            transition: border-color 0.3s ease;
            width: 80px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
		
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-20px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤿 Duikplanner</h1>
		<div class="settings-section">
            <h3>⚙️ Dive Settings</h3>
            <div class="settings-row">
                <div class="input-group">
                    <label for="airConsumption">Verbruik(L/min)</label>
                    <input type="number" name="airConsumption_preset" value="21" step="0.1" min="0">
				</div>
				<div class="input-group">
					<label for="airConsumption">Flesinhoud (L)</label>
                    <input type="number" name="Flesinhoud" value="10" step="0.1" min="0">
				</div>
				<div class="input-group">
					<label for="airConsumption">Flesdruk (bar)</label>
					<input type="number" name="Flesdruk" value="280" step="0.1" min="0">
                </div>
            </div>
        </div>
		

		
        <div class="chart-container">
            <h2>Diepteprofiel</h2>
            <canvas id="depthChart" width="800"></canvas>
        </div>
        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr id="headerRow">
                        <th class="row-number">#</th>
                        <th class="time_cumu">Tijd cumu</th>
                        <th class="time">Tijd (min)</th>
                        <th class="depth">diepte (m)</th>
                        <th class="depth_pressure">bar druk</th>
						<th class="air_consumption">luchtverbruik (L)</th>
						<th class="air_consumption">resterende flesdruk (bar)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="fade-in" draggable="true">
                        <td class="row-number drag-handle">1</td>
                        <td><input type="number" name="time_cumu_val" class="readonly" value="0" placeholder="0" step=".5" readonly="readonly"></td>
                        <td><input type="number" name="time_val" class="readonly" value="0" placeholder="0" step=".5" readonly="readonly"></td>
                        <td><input type="number" name="depth_val" class="readonly" value="0" placeholder="0" step="0.1" readonly="readonly"></td>
                        <td><input type="number" name="depth_pressure_val" class="readonly" value="1.0" placeholder="1.0" step="0.1" readonly="readonly"></td>
						<td><input type="number" name="air_consumption_val" class="readonly" value="0" placeholder="0" step=".5" readonly="readonly"></td>
						<td><input type="number" name="remaining_pressure_val" class="readonly" value="0" placeholder="0" step=".5" readonly="readonly"></td>
                        <td class="actions">
                            <div class="move-buttons">
                                <button class="btn btn-move" onclick="moveRowUp(this)" title="Move Up">↑</button>
                                <button class="btn btn-move" onclick="moveRowDown(this)" title="Move Down">↓</button>
                                <button class="btn btn-danger" onclick="deleteRow(this)">🗑️</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
		<div class="controls">
            <button class="btn btn-primary" onclick="addRow()">➕ Add Row</button>
			<button class="btn btn-primary" onclick="add2Rows()">➕ Add 2 Rows</button>
			<button class="btn btn-primary" onclick="addSafetyStop()">➕ Add Safety stop</button>
        </div>
				<div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalTime" name="totalTimeMetric">0</div>
                <div class="stat-label">Total Time (min)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxDepth">0</div>
                <div class="stat-label">Max Depth (m)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgDepth">0</div>
                <div class="stat-label">Avg Depth (m)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalAirConsumption">0</div>
                <div class="stat-label">Total Air (L)</div>
            </div>
        </div>
		
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        let rowCounter = 1;
        let depthChart = null;

        // Initialize the chart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#tableBody tr').forEach(setupDragAndDrop);
            initializeChart();
            updateChart();
        });

        function initializeChart() {
			const ctx = document.getElementById('depthChart').getContext('2d');
			
			depthChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: [],
					datasets: [{
						label: 'Depth Profile',
						data: [],
						borderColor: 'rgb(102, 126, 234)',
						backgroundColor: 'rgba(102, 126, 234, 0.1)',
						borderWidth: 3,
						fill: true,
						tension: 0.05,
						pointBackgroundColor: 'rgb(118, 75, 162)',
						pointBorderColor: 'white',
						pointBorderWidth: 2,
						pointRadius: 6,
						pointHoverRadius: 8
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: {
							display: true,
							position: 'top',
							labels: {
								font: {
									size: 14,
									weight: 'bold'
								},
								color: '#333'
							}
						},
						tooltip: {
							backgroundColor: 'rgba(0, 0, 0, 0.8)',
							titleColor: 'white',
							bodyColor: 'white',
							borderColor: 'rgb(102, 126, 234)',
							borderWidth: 1,
							callbacks: {
								label: function(context) {
									return `Depth: ${Math.abs(context.parsed.y)} meters`;
								},
								title: function(context) {
									if (context.length > 0) {
										const timeValue = context[0].parsed.x;
										return `Time: ${timeValue} minutes`;
									}
									return '';
								}
							}
						}
					},
					scales: {
						x: {
							type: 'linear',
							title: {
								display: true,
								text: 'Time (minutes)',
								font: {
									size: 14,
									weight: 'bold'
								},
								color: '#333'
							},
							grid: {
								color: 'rgba(0, 0, 0, 0.1)'
							},
							ticks: {
								color: '#666',
								stepSize: 1,
								callback: function(value) {
									return value + ' min';
								}
							}
						},
						y: {
							title: {
								display: true,
								text: 'Depth (meters)',
								font: {
									size: 14,
									weight: 'bold'
								},
								color: '#333'
							},
							reverse: true, // This inverts the Y-axis
							grid: {
								color: 'rgba(0, 0, 0, 0.1)'
							},
							ticks: {
								color: '#666',
								callback: function(value) {
									return Math.abs(value) + 'm';
								}
							}
						}
					},
					interaction: {
						intersect: false,
						mode: 'index'
					}
				}
			});
		}

		function updateChart() {
			if (!depthChart) return;
			
			const rows = document.querySelectorAll('#tableBody tr');
			const chartData = [];
			
			rows.forEach(row => {
				const timeAccInput = row.querySelector('Input[name="time_cumu_val"');
				const depthInput = row.querySelector('Input[name="depth_val"');
				
				if (timeAccInput && depthInput) {
					const minutes = parseFloat(timeAccInput.value) || 0;
					const depth = parseFloat(depthInput.value) || 0;
					
					chartData.push({ x: minutes, y: Math.abs(depth) });
				}
			});
			
			// Sort data by minutes to ensure proper line progression
			chartData.sort((a, b) => a.x - b.x);
			
			// Use actual time values - Chart.js will handle proper spacing automatically
			depthChart.data.labels = chartData.map(point => point.x);
			depthChart.data.datasets[0].data = chartData;
			depthChart.update();
		}

        function updateTimeAccumulated() {
            const rows = document.querySelectorAll('#tableBody tr');
            let cumulativeTime = 0;
            
            rows.forEach(row => {
                const timeAccInput = row.querySelector('Input[name="time_cumu_val"]');
                const minutesInput = row.querySelector('Input[name="time_val"]');
                
                if (timeAccInput && minutesInput) {
                    const minutes = parseFloat(minutesInput.value) || 0;
                    cumulativeTime += minutes;
                    timeAccInput.value = cumulativeTime;
					
                }
            });
        }
		
		function updateDepthPressure() {
            const rows = document.querySelectorAll('#tableBody tr');
            let depthPressure = 1;
            
            rows.forEach(row => {
                const depthPressureInput = row.querySelector('Input[name="depth_pressure_val"]');
                const depthInput = row.querySelector('Input[name="depth_val"]');
				const depth = parseFloat(depthInput.value) || 0;
				depthPressure = (depth / 10) + 1;
				depthPressureInput.value = depthPressure;
            });
        }
		
		function updateAirConsumption() {
            const rows = document.querySelectorAll('#tableBody tr');
			const airConsumptionPreset = document.querySelector('Input[name="airConsumption_preset"]').value;
            let startPressure = 1.0;
			let currentPressure = 1.0;
			let timeValue = 0;
			
            rows.forEach(row => {
				const timeInput=row.querySelector('Input[name="time_val"]')
                const airConsumptionInput= row.querySelector('Input[name="air_consumption_val"]');
				const depthPressureInput = row.querySelector('Input[name="depth_pressure_val"]');
				const currentPressure = parseFloat(depthPressureInput.value);
				const timeValue=timeInput.value;
				airconsumption = (Math.abs((currentPressure-startPressure)/2)+Math.min(currentPressure, startPressure)) * airConsumptionPreset * timeValue;
				airConsumptionInput.value = airconsumption;
				startPressure = currentPressure;
            });
        }
		function updateRemainingPressure() {
			const rows = document.querySelectorAll('#tableBody tr');
			const airCylinderPreset = document.querySelector('Input[name="Flesdruk"]').value;
			console.log(airCylinderPreset)
			const airCylinderVolumePreset= document.querySelector('Input[name="Flesinhoud"]').value;
			console.log(airCylinderVolumePreset)
			
            let startCylinderPressure = airCylinderPreset;
			let remainingCylinderPressure = startCylinderPressure;
			
            rows.forEach(row => {
                const airConsumptionInput= row.querySelector('Input[name="air_consumption_val"]');
				const remainingCylinderPressureInput= row.querySelector('Input[name="remaining_pressure_val"]');
				const airConsumptionPressure = airConsumptionInput.value / airCylinderVolumePreset ;
				
				remainingCylinderPressure = startCylinderPressure- airConsumptionPressure;
				if(remainingCylinderPressure <=0){
					remainingCylinderPressureInput.value = 0
				} else {
					remainingCylinderPressureInput.value = remainingCylinderPressure;
				}
	
				
				startCylinderPressure = remainingCylinderPressure;
            });
        }
        // Add event listeners to update chart when data changes
        function setupInputListeners(row) {
            const inputs = row.querySelectorAll('.editable');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateTimeAccumulated();
					updateDepthPressure();
					updateChart();
					updateAirConsumption();
					updateRemainingPressure();
					updateMetrics();

                   
                });
                input.addEventListener('change', function() {
                    updateTimeAccumulated();
					updateDepthPressure();
					updateChart();
					updateAirConsumption();
					updateRemainingPressure();
					updateMetrics();

                    
                });
            });
        }

        function addRow(time=0, depth=0) {
            const tableBody = document.getElementById('tableBody');
            const headerRow = document.getElementById('headerRow');
            const columnCount = headerRow.children.length - 2; // Exclude row number and actions columns
			
            rowCounter++;
            
            const newRow = document.createElement('tr');
            newRow.className = 'fade-in';
            
            // Row number
            const rowNumberCell = document.createElement('td');
            rowNumberCell.className = 'row-number drag-handle';
            rowNumberCell.textContent = rowCounter;
            newRow.appendChild(rowNumberCell);
            
            // Data columns
            for (let i = 0; i < columnCount; i++) {
                const cell = document.createElement('td');
                const input = document.createElement('input');
                
                // Set input type based on column
                if (i === 0) { // Time Accumulated
                    input.type = 'number';
                    input.placeholder = '0';
                    input.step = '0.1';
					input.name='time_cumu_val';
					input.className = 'readonly';
                    input.readOnly = true;
                } else if (i === 1) { // Time Minutes
                    input.type = 'number';
					input.name="time_val";
					input.className = 'editable';
                    input.placeholder = time;
					if (time || depth){
						input.value=time;
					} else {
						input.placeholder = '0';
					}
                } else if (i === 2) { // Depth
                    input.type = 'number';
                    if (time || depth){
						input.value=depth;
					} else {
						input.placeholder = '0';
					}
                    input.step = '0.5';
					input.className = 'editable';
					input.name= "depth_val";
                } else if (i === 3) { // Pressure on Depth
                    input.type = 'number';
                    input.placeholder = '1.0';
					input.name="depth_pressure_val";
                    input.step = '0.1';
					input.className = 'readonly';
					input.readOnly = true;
                } else if (i === 4) { // used air
                    input.type = 'number';
                    input.placeholder = '1.0';
					input.name="air_consumption_val";
					input.className = 'readonly';
                    input.step = '0.1';
					input.readOnly= true;
				} else if (i === 5) { // used air
                    input.type = 'number';
                    input.placeholder = '1.0';
					input.name="remaining_pressure_val";
					input.className = 'readonly';
                    input.step = '0.1';
					input.readOnly= true;
				} else {
                    input.type = 'text';
                    input.placeholder = 'Enter data...';
                }
                
                
                cell.appendChild(input);
                newRow.appendChild(cell);
            }
            
			
            // Actions column
            const actionsCell = document.createElement('td');
            actionsCell.className = 'actions';
            actionsCell.innerHTML = `
                <div class="move-buttons">
                    <button class="btn btn-move" onclick="moveRowUp(this)" title="Move Up">↑</button>
                    <button class="btn btn-move" onclick="moveRowDown(this)" title="Move Down">↓</button>
                    <button class="btn btn-danger" onclick="deleteRow(this)">🗑️</button>
                </div>
            `;
            newRow.appendChild(actionsCell);

            // Make row draggable
            newRow.draggable = true;
            setupDragAndDrop(newRow);
            setupInputListeners(newRow);
            
            tableBody.appendChild(newRow);
            updateTimeAccumulated();
            updateChart();
			updateAirConsumption();
			updateRemainingPressure();
        }
		
		// Function to calculate total of 'time' column (time_val)
		function getTotalTime() {
			const timeInputs = document.querySelectorAll('input[name="time_val"]');
			let total = 0;
			
			timeInputs.forEach(input => {
				const value = parseFloat(input.value) || 0;
				total += value;
			});
			
			return total;
		}

		// Function to get maximum depth
		function getMaxDepth() {
			const depthInputs = document.querySelectorAll('input[name="depth_val"]');
			let max = 0;
			
			depthInputs.forEach(input => {
				const value = parseFloat(input.value) || 0;
				if (value > max) {
					max = value;
				}
			});
			
			return max;
		}

		// Function to calculate average depth
		// Function to calculate time-weighted average depth including descent/ascent
		function getAvgDepth() {
			const rows = document.querySelectorAll('#tableBody tr');
			let totalTimeWeightedDepth = 0;
			let totalTime = 0;
			let previousDepth = 0; // Starting depth is 0 (surface)
			
			rows.forEach(row => {
				const timeInput = row.querySelector('input[name="time_val"]');
				const depthInput = row.querySelector('input[name="depth_val"]');
				
				const time = parseFloat(timeInput?.value) || 0;
				const currentDepth = parseFloat(depthInput?.value) || 0;
				
				if (time > 0) { // Only count rows with time > 0
					// Calculate average depth for this time segment (linear interpolation)
					const segmentAvgDepth = (previousDepth + currentDepth) / 2;
					
					totalTimeWeightedDepth += time * segmentAvgDepth;
					totalTime += time;
				}
				
				// Update previous depth for next iteration
				previousDepth = currentDepth;
			});
			
			return totalTime > 0 ? totalTimeWeightedDepth / totalTime : 0;
		}

		// Function to calculate total air consumption
		function getTotalAirConsumption() {
			const airInputs = document.querySelectorAll('input[name="air_consumption_val"]');
			let total = 0;
			
			airInputs.forEach(input => {
				const value = parseFloat(input.value) || 0;
				total += value;
			});
			
			return total;
		}

		// Function to get all calculations at once
		function getAllCalculations() {
			return {
				totalTime: getTotalTime(),
				maxDepth: getMaxDepth(),
				avgDepth: getAvgDepth(),
				totalAirConsumption: getTotalAirConsumption()
			};
		}
		
		// Function to get all calculations at once
		function getAllCalculations() {
			return {
				totalTime: getTotalTime(),
				maxDepth: getMaxDepth(),
				avgDepth: getAvgDepth(),
				totalAirConsumption: getTotalAirConsumption()
			};
		}
		// Optional: Function to get all calculations at once
		function updateMetrics() {
			const calculations = getAllCalculations();
			document.getElementById('totalTime').textContent = calculations.totalTime.toFixed(1);
			document.getElementById('maxDepth').textContent = calculations.maxDepth.toFixed(1);
			document.getElementById('avgDepth').textContent = calculations.avgDepth.toFixed(1);
			document.getElementById('totalAirConsumption').textContent = calculations.totalAirConsumption.toFixed(1);
		}
		
		function add2Rows(){
			addRow();
			addRow();
		}
		function addSafetyStop(){
			addRow(0,5);
			addRow(3,5);
			addRow(0.5,0);
			updateMetrics();
		
		}
		
        function deleteRow(button) {
            const row = button.closest('tr');
            row.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                row.remove();
                updateRowNumbers();
                updateTimeAccumulated();
                updateChart();
				updateAirConsumption();
				updateRemainingPressure();
				updateMetrics();
            }, 300);
        }

        function updateRowNumbers() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                const rowNumberCell = row.querySelector('.row-number');
                if (rowNumberCell) {
                    rowNumberCell.textContent = index + 1;
                }
            });
            rowCounter = rows.length;
        }
		
        function moveRowUp(button) {
            const row = button.closest('tr');
            const previousRow = row.previousElementSibling;
            if (previousRow) {
                row.parentNode.insertBefore(row, previousRow);
                updateRowNumbers();
                updateTimeAccumulated();
                updateChart();
				updateAirConsumption();
				updateRemainingPressure();
            }
        }

        function moveRowDown(button) {
            const row = button.closest('tr');
            const nextRow = row.nextElementSibling;
            if (nextRow) {
                row.parentNode.insertBefore(nextRow, row);
                updateRowNumbers();
                updateTimeAccumulated();
                updateChart();
				updateAirConsumption();
				updateRemainingPressure();
            }
        }

        // Drag and Drop functionality
        let draggedRow = null;

        function setupDragAndDrop(row) {
            row.addEventListener('dragstart', function(e) {
                draggedRow = this;
                this.classList.add('dragging');
            });

            row.addEventListener('dragend', function(e) {
                this.classList.remove('dragging');
                draggedRow = null;
                // Remove all drop zones
                document.querySelectorAll('.drop-zone').forEach(el => {
                    el.classList.remove('drop-zone');
                });
            });

            row.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            row.addEventListener('dragenter', function(e) {
                e.preventDefault();
                if (this !== draggedRow) {
                    this.classList.add('drop-zone');
                }
            });

            row.addEventListener('dragleave', function(e) {
                this.classList.remove('drop-zone');
            });

            row.addEventListener('drop', function(e) {
                e.preventDefault();
                if (this !== draggedRow && draggedRow) {
                    const tableBody = document.getElementById('tableBody');
                    const rows = Array.from(tableBody.children);
                    const draggedIndex = rows.indexOf(draggedRow);
                    const targetIndex = rows.indexOf(this);

                    if (draggedIndex < targetIndex) {
                        tableBody.insertBefore(draggedRow, this.nextSibling);
                    } else {
                        tableBody.insertBefore(draggedRow, this);
                    }
                    
                    updateRowNumbers();
                    updateTimeAccumulated();
                    updateChart();
                }
                this.classList.remove('drop-zone');
            });
        }
		
		function setCache(){
			air_table=document.querySelectorAll('#tableBody tr');
			localStorage.setItem("air_table", air_table);
		}
		function loadCache(){
			air_table=document.querySelectorAll('#tableBody tr')
			air_table=localStorage.getItem("air_table");
			
		}
		
        // Initialize drag and drop for existing rows
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#tableBody tr').forEach(row => {
                setupDragAndDrop(row);
                setupInputListeners(row);
            });
            initializeChart();
            updateChart();
			updateAirConsumption();
			updateRemainingPressure();
        });
		
				
    </script>
</body>
</html>
